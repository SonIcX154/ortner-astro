---
import Layout from '../layouts/MainLayout.astro';
import { getWPPages, getWPPage } from '../lib/wp-client';

export async function getStaticPaths() {
  const pages = await getWPPages();
  return pages.map(page => ({
    params: { slug: page.slug },
  }));
}

const { slug } = Astro.params;
const page = await getWPPage(slug);
const pageData = page[0];

// Extract SEO data
const title = pageData?.title.rendered || slug;
const description = pageData?.excerpt?.rendered?.replace(/<[^>]*>/g, '').slice(0, 160) || '';
const featuredImage = pageData?._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
---
<Layout title={title} description={description} image={featuredImage}>
  <article class="page-content">
    <h1>{title}</h1>
    <div set:html={pageData?.content.rendered || '<p>Inhalt wird von WordPress geladen...</p>'} />
  </article>
</Layout>

<style>
  .page-content {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
  }
</style>